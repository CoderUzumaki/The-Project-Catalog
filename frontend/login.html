<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Stitch Design</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B600%3B700&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/tailwindcss">
    </style>
</head>
<body class="bg-slate-50 font-sans">
<div class="relative flex size-full min-h-screen flex-col overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-slate-200 px-10 py-4">
            <div class="flex items-center gap-3 text-slate-900">
                <svg class="h-8 w-8 text-[var(--primary-color)]" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                    <path d="M42.4379 44H5.56208C4.49645 44 3.74621 43.1357 3.89357 42.0735L8.253 4.92705C8.37906 4.02014 9.18335 3.33333 10.0974 3.33333H37.9026C38.8166 3.33333 39.6209 4.02014 39.747 4.92705L44.1064 42.0735C44.2538 43.1357 43.5035 44 42.4379 44Z" fill="currentColor"></path>
                </svg>
                <h2 class="text-slate-900 text-lg font-bold leading-tight tracking-[-0.015em]">Stitch Design</h2>
            </div>
            <div class="flex gap-2">
                <button class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 text-slate-900 text-sm font-bold leading-normal tracking-[0.015em]">
                    <span class="truncate">Help</span>
                </button>
            </div>
        </header>
        <div class="px-40 flex flex-1 justify-center py-5">
            <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
                <div class="flex flex-wrap justify-between gap-3 p-4">
                    <div class="flex min-w-72 flex-col gap-3">
                        <p class="text-slate-900 tracking-light text-[32px] font-bold leading-tight">Sign in to your account</p>
                        
                        <!-- Success/Error Messages -->
                        <div id="message-container"></div>
                        
                        <div class="flex flex-col gap-3">
                            <!-- Google OAuth Button -->
                            <button id="google-btn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-5 flex-1 bg-slate-100 text-slate-900 text-base font-bold leading-normal tracking-[0.015em] gap-3">
                                <svg viewBox="0 0 48 48" class="h-6 w-6">
                                    <path fill="#fbc02d" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path>
                                    <path fill="#e53935" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path>
                                    <path fill="#4caf50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path>
                                    <path fill="#1565c0" d="M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path>
                                </svg>
                                <span id="google-text">Continue with Google</span>
                            </button>
                            
                            <div class="flex items-center gap-3 py-3">
                                <div class="h-px bg-slate-200 flex-1"></div>
                                <p class="text-slate-500 text-sm font-medium leading-normal">or</p>
                                <div class="h-px bg-slate-200 flex-1"></div>
                            </div>
                            
                            <!-- Email/Password Form -->
                            <form id="login-form" class="flex flex-col gap-3">
                                <input type="email" id="email" placeholder="Email" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-slate-900 focus:outline-0 focus:ring-0 border border-slate-200 bg-slate-50 focus:border-slate-200 h-14 placeholder:text-slate-500 p-[15px] text-base font-normal leading-normal" required>
                                <input type="password" id="password" placeholder="Password" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-slate-900 focus:outline-0 focus:ring-0 border border-slate-200 bg-slate-50 focus:border-slate-200 h-14 placeholder:text-slate-500 p-[15px] text-base font-normal leading-normal" required>
                                <button type="submit" id="login-btn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-5 flex-1 bg-slate-900 text-slate-50 text-base font-bold leading-normal tracking-[0.015em]">
                                    <span id="login-text">Sign in</span>
                                </button>
                            </form>
                        </div>
                        
                        <p class="text-slate-500 text-sm font-normal leading-normal">
                            Don't have an account? 
                            <a href="#" class="text-slate-900 font-bold">Sign up</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const messageContainer = document.getElementById('message-container');
    const googleBtn = document.getElementById('google-btn');
    const googleText = document.getElementById('google-text');
    const loginForm = document.getElementById('login-form');
    const loginBtn = document.getElementById('login-btn');
    const loginText = document.getElementById('login-text');

    // Function to show messages
    function showMessage(message, isError = false) {
        const className = isError ? 'bg-red-100 border border-red-400 text-red-700' : 'bg-green-100 border border-green-400 text-green-700';
        messageContainer.innerHTML = `
            <div class="${className} px-4 py-3 rounded mb-4">
                ${message}
            </div>
        `;
    }

    // Check for OAuth callback tokens in URL fragment
    function handleOAuthCallback() {
        const fragment = window.location.hash.substring(1);
        const params = new URLSearchParams(fragment);
        
        const accessToken = params.get('access_token');
        const refreshToken = params.get('refresh_token');
        const error = params.get('error');
        const errorDescription = params.get('error_description');

        if (error) {
            showMessage(`OAuth Error: ${errorDescription || error}`, true);
            // Clean URL
            window.history.replaceState({}, document.title, window.location.pathname);
            return;
        }

        if (accessToken) {
            // Send tokens to backend for session creation
            googleText.textContent = 'Processing...';
            googleBtn.disabled = true;
            
            fetch('/auth/process-oauth', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    access_token: accessToken,
                    refresh_token: refreshToken
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 200) {
                    showMessage(data.message || 'Google login successful!');
                    // Redirect or update UI as needed
                    setTimeout(() => {
                        window.location.href = '/dashboard'; // or wherever you want to redirect
                    }, 1500);
                } else {
                    showMessage(data.detail || 'Login failed', true);
                }
            })
            .catch(error => {
                showMessage('Network error: ' + error.message, true);
            })
            .finally(() => {
                googleText.textContent = 'Continue with Google';
                googleBtn.disabled = false;
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
            });
        }
    }

    // Check for URL parameters (success/error messages)
    function checkUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');
        const success = urlParams.get('success');
        
        if (error) {
            showMessage(decodeURIComponent(error), true);
        } else if (success) {
            showMessage(decodeURIComponent(success));
        }
    }

    // Handle OAuth callback on page load
    handleOAuthCallback();
    checkUrlParams();

    // Google OAuth button click
    googleBtn.addEventListener('click', function() {
        googleText.textContent = 'Redirecting...';
        googleBtn.disabled = true;
        window.location.href = '/auth/google';
    });

    // Email/Password login form
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!email || !password) {
            showMessage('Please enter both email and password', true);
            return;
        }
        
        loginText.textContent = 'Signing in...';
        loginBtn.disabled = true;
        
        fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: email,
                password: password
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 200) {
                showMessage(data.message || 'Login successful!');
                // Redirect or update UI as needed
                setTimeout(() => {
                    window.location.href = '/dashboard'; // or wherever you want to redirect
                }, 1500);
            } else {
                showMessage(data.detail || 'Login failed', true);
            }
        })
        .catch(error => {
            showMessage('Network error: ' + error.message, true);
        })
        .finally(() => {
            loginText.textContent = 'Sign in';
            loginBtn.disabled = false;
        });
    });
});
</script>

</body>
</html>